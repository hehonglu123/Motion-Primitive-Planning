import numpy as np
from general_robotics_toolbox import *
import sys
# sys.path.append('../abb_motion_program_exec')
from abb_motion_program_exec_client import *



def quadrant(q):
    temp=np.ceil(np.array([q[0],q[3],q[5]])/(np.pi/2))-1
    
    if q[4] < 0:
        last = 1
    else:
        last = 0

    return np.hstack((temp,[last])).astype(int)
def main():
    quatR = R2q(rot([0,1,0],math.radians(30)))
    tool = tooldata(True,pose([50,0,450],[quatR[0],quatR[1],quatR[2],quatR[3]]),loaddata(1,[0,0,0.001],[1,0,0,0],0,0,0))
    vmax=speeddata(99999,99999,99999,99999)
    mp = MotionProgram(tool=tool)

    j1 = jointtarget([35.94454574584961, 48.237125396728516, -14.307827949523926, 97.9395751953125, -51.629547119140625, 45.57244110107422],[0]*6)

    mp.MoveAbsJ(j1,vmax,fine)
    mp.WaitTime(1)
    mp.MoveAbsJ(j1,vmax,fine)
    mp.WaitTime(0.1)
    r1=robtarget([2314.29541015625, 959.2286987304688, 702.333740234375],[0.28590020537376404, 0.6616340279579163, 0.41060611605644226, 0.5584837198257446],confdata(0,1,0,1),[0.0, 0.0, 0.0, 0.0, 0.0, 0.0])
    r2=robtarget([2284.731689453125, 827.3866577148438, 677.3859252929688],[0.4960663616657257, 0.6235132813453674, 0.44181525707244873, 0.41224825382232666],confdata(0,1,0,1),[0.0, 0.0, 0.0, 0.0, 0.0, 0.0])
    mp.MoveC(r1,r2,vmax,z10)
    r1=robtarget([2250.64013671875, 713.3120727539062, 674.6148681640625],[0.4960663616657257, 0.6235132813453674, 0.44181525707244873, 0.41224825382232666],confdata(0,1,0,1),[0.0, 0.0, 0.0, 0.0, 0.0, 0.0])
    r2=robtarget([2211.94384765625, 601.2698364257812, 685.3701171875],[0.5871954560279846, 0.5657910108566284, 0.4558606445789337, 0.35675355792045593],confdata(0,0,0,1),[0.0, 0.0, 0.0, 0.0, 0.0, 0.0])
    mp.MoveC(r1,r2,vmax,z10)
    r1=robtarget([2176.5888671875, 499.4919128417969, 697.7767944335938],[0.6097803711891174, 0.5352163314819336, 0.447731077671051, 0.3758300542831421],confdata(0,0,0,1),[0,0,0,0,0,0])
    mp.MoveL(r1,vmax,z10)
    r1=robtarget([2121.95166015625, 342.1473083496094, 726.41015625],[0.6319235563278198, 0.4955090284347534, 0.4469960629940033, 0.39412933588027954],confdata(0,0,0,1),[0,0,0,0,0,0])
    mp.MoveL(r1,vmax,z10)
    r1=robtarget([2083.86669921875, 206.17901611328125, 745.2900390625],[0.6319235563278198, 0.4955090284347534, 0.4469960629940033, 0.39412933588027954],confdata(0,0,0,1),[0.0, 0.0, 0.0, 0.0, 0.0, 0.0])
    r2=robtarget([2055.840576171875, 66.83906555175781, 753.8182983398438],[0.6030036807060242, 0.4525947868824005, 0.4058225154876709, 0.5165777802467346],confdata(0,0,0,1),[0.0, 0.0, 0.0, 0.0, 0.0, 0.0])
    mp.MoveC(r1,r2,vmax,z10)
    r1=robtarget([2047.5167236328125, -66.45745849609375, 740.4225463867188],[0.6030036807060242, 0.4525947868824005, 0.4058225154876709, 0.5165777802467346],confdata(0,0,0,1),[0.0, 0.0, 0.0, 0.0, 0.0, 0.0])
    r2=robtarget([2059.7177734375, -194.4718017578125, 702.2003173828125],[0.46654585003852844, 0.4307190179824829, 0.26630499958992004, 0.7251880764961243],confdata(0,0,1,1),[0.0, 0.0, 0.0, 0.0, 0.0, 0.0])
    mp.MoveC(r1,r2,vmax,z10)
    r1=robtarget([2088.90673828125, -288.4089660644531, 648.1708374023438],[0.46654585003852844, 0.4307190179824829, 0.26630499958992004, 0.7251880764961243],confdata(0,0,1,1),[0.0, 0.0, 0.0, 0.0, 0.0, 0.0])
    r2=robtarget([2131.48388671875, -368.17034912109375, 581.7415771484375],[0.3616293966770172, 0.3841124475002289, 0.011740372516214848, 0.8494374752044678],confdata(-1,0,1,1),[0.0, 0.0, 0.0, 0.0, 0.0, 0.0])
    mp.MoveC(r1,r2,vmax,z10)
    r1=robtarget([2151.381103515625, -396.91864013671875, 552.3739624023438],[0.3616293966770172, 0.3841124475002289, 0.011740372516214848, 0.8494374752044678],confdata(-1,0,1,1),[0.0, 0.0, 0.0, 0.0, 0.0, 0.0])
    r2=robtarget([2172.469970703125, -424.5322265625, 522.8565063476562],[0.394143283367157, 0.35620251297950745, -0.08311927318572998, 0.8431263566017151],confdata(-1,0,1,1),[0.0, 0.0, 0.0, 0.0, 0.0, 0.0])
    mp.MoveC(r1,r2,vmax,z10)
    r1=robtarget([2193.969970703125, -453.0318603515625, 492.22607421875],[0.3561868667602539, 0.3564993441104889, -0.11466551572084427, 0.8560904860496521],confdata(-1,0,1,1),[0,0,0,0,0,0])
    mp.MoveL(r1,vmax,z10)
    r1=robtarget([2216.30517578125, -474.578369140625, 462.5780944824219],[0.3688212037086487, 0.3179946839809418, -0.15984360873699188, 0.858661949634552],confdata(-1,0,1,1),[0,0,0,0,0,0])
    mp.MoveL(r1,vmax,fine)

    client = MotionProgramExecClient()
    log_results = client.execute_motion_program(mp)

    # Write log csv to file
    with open("tests/log.csv","wb") as f:
       f.write(log_results)

if __name__ == '__main__':
    main()